<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password OTP - Soleway</title>
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/user-assets/images/icons/FAVICON SW.png">
    <!-- CSS Files -->
    <link rel="stylesheet" href="/userMng-assets/css/vendor/vendor.min.css">
    <link rel="stylesheet" href="/userMng-assets/css/plugins/plugins.min.css">
    <link rel="stylesheet" href="/userMng-assets/css/style.min.css">
    <link rel="stylesheet" href="/userMng-assets/css/otp.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Start Header Area -->
    <header class="header-section d-none d-xl-block">
        <div class="header-wrapper">
            <div class="header-bottom header-bottom-color--black section-fluid sticky-header sticky-color--Black blackbg">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12 d-flex align-items-center justify-content-start color--Black blackbg">
                            <!-- Start Header Logo -->
                            <div class="header-logo">
                                <div class="logo">
                                    <a href="/"><img src="/userMng-assets/images/logo/1.png" alt="Soleway Logo"></a>
                                </div>
                            </div>
                            <!-- End Header Logo -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- End Header Area -->

    <!-- Start Mobile Header -->
    <div class="mobile-header mobile-header-bg-color--black section-fluid d-lg-block d-xl-none">
        <div class="container">
            <div class="row">
                <div class="col-12 d-flex align-items-center justify-content-start">
                    <!-- Start Mobile Left Side -->
                    <div class="mobile-header-left">
                        <ul class="mobile-menu-logo">
                            <li>
                                <a href="/">
                                    <div class="logo">
                                        <img src="/userMng-assets/images/logo/1.png" alt="Soleway Logo">
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <!-- End Mobile Left Side -->
                </div>
            </div>
        </div>
    </div>
    <!-- End Mobile Header -->

    <!-- Start OTP Verification Section -->
    <div class="container">
        <div class="otp-card">
            <h1>Reset Password OTP</h1>
            <form id="otpForm" action="/resetOtp" method="post" onsubmit="return validateOtp()">
                <label for="otpCode" class="center-label">Enter the OTP code sent to your email:</label>
                <div class="otp-field">
                    <input type="text" id="otp1" maxlength="1" minlength="1" aria-label="OTP digit 1" required>
                    <input type="text" id="otp2" maxlength="1" minlength="1" disabled aria-label="OTP digit 2" required>
                    <input type="text" id="otp3" maxlength="1" minlength="1" disabled aria-label="OTP digit 3" required>
                    <input type="text" id="otp4" maxlength="1" minlength="1" disabled aria-label="OTP digit 4" required>
                </div>
                <input type="hidden" id="otpCode" name="otp">
                <button type="submit" aria-label="Verify OTP">Verify OTP Code</button>
                <button type="button" id="resendButton" onclick="resendOTP()" disabled aria-label="Resend OTP">Resend OTP</button>
                <div id="timerDisplay"></div>
                <h3 class="text-success" id="loginSuccessMessage">
                    <%= locals.successMessage ? successMessage : '' %>
                </h3>
                <% if (typeof message !== 'undefined' && message) { %>
                    <script>
                        document.addEventListener('DOMContentLoaded', () => {
                            Toastify({
                                text: "<%= message %>",
                                duration: 3000,
                                close: true,
                                gravity: "top",
                                position: "right",
                                backgroundColor: "#dc3545",
                                stopOnFocus: true
                            }).showToast();
                        });
                    </script>
                <% } %>
            </form>
        </div>
    </div>
    <!-- End OTP Verification Section -->

    <!-- Start Footer Section -->
    <footer class="footer-section">
        <div class="footer-wrapper">
            <div class="footer-logo">
                <a href="/"><img src="/userMng-assets/images/logo/1.png" alt="Soleway Logo"></a>
            </div>
            <div class="footer-contact">
                <p>Address: Your address goes here.</p>
                <p>Call Us: 6238381782</p>
                <p>Email: akhildasdas191@gmail.com</p>
            </div>
            <div class="footer-social">
                <a href="#"><i class="fa fa-facebook"></i></a>
                <a href="#"><i class="fa fa-twitter"></i></a>
                <a href="#"><i class="fa fa-instagram"></i></a>
                <a href="#"><i class="fa fa-linkedin"></i></a>
            </div>
        </div>
    </footer>
    <!-- End Footer Section -->

    <!-- Scripts -->
    <script src="/userMng-assets/js/vendor/vendor.min.js" defer></script>
    <script src="/userMng-assets/js/plugins/plugins.min.js" defer></script>
    <script src="/userMng-assets/js/main.js" defer></script>
    <script src="/userMng-assets/js/otp.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script>
        let timerDuration = 20; // resend OTP timer setting
        let timer;

        function startTimer() {
            let seconds = timerDuration;
            timer = setInterval(function () {
                document.getElementById("timerDisplay").innerHTML = `Resend OTP in ${seconds} seconds`;

                if (--seconds < 0) {
                    clearInterval(timer);
                    document.getElementById("timerDisplay").innerHTML = "";
                    document.getElementById("resendButton").disabled = false;
                }
            }, 1000);
        }

        function resendOTP() {
            document.getElementById("resendButton").disabled = true;
            startTimer();

            fetch('/userNewOtp', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                Toastify({
                    text: "OTP resent successfully!",
                    duration: 3000,
                    close: true,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "#28a745",
                    stopOnFocus: true
                }).showToast();
            })
            .catch(error => {
                Toastify({
                    text: "Error resending OTP!",
                    duration: 3000,
                    close: true,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "#dc3545",
                    stopOnFocus: true
                }).showToast();
            });
        }

        function validateOtp() {
            let otp1 = document.getElementById('otp1').value;
            let otp2 = document.getElementById('otp2').value;
            let otp3 = document.getElementById('otp3').value;
            let otp4 = document.getElementById('otp4').value;
            let otpCode = otp1 + otp2 + otp3 + otp4;
            document.getElementById('otpCode').value = otpCode;

            if (otpCode.length !== 4 || otp1 === "" || otp2 === "" || otp3 === "" || otp4 === "") {
                Toastify({
                    text: "Please enter a valid 4-digit OTP code.",
                    duration: 3000,
                    close: true,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "#dc3545",
                    stopOnFocus: true
                }).showToast();
                return false;
            }
            return true;
        }

        const inputs = document.querySelectorAll('.otp-field input');
        inputs[0].focus();

        for (let index = 0; index < inputs.length; index++) {
            const input = inputs[index];

            input.addEventListener('input', () => {
                input.value = input.value.replace(/[^0-9]/g, '');
                if (input.value.length === 1) {
                    if (index !== inputs.length - 1) {
                        inputs[index + 1].removeAttribute('disabled');
                        inputs[index + 1].focus();
                    }
                } else {
                    if (index !== 0) {
                        inputs[index].value = '';
                        inputs[index - 1].focus();
                    }
                }
            });

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace') {
                    if (input.value.length === 0 && index !== 0) {
                        inputs[index - 1].focus();
                    }
                }
            });
        }

        window.onload = startTimer;
    </script>
</body>
</html>