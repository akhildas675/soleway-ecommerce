<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Wallet - Soleway</title>
    <link rel="shortcut icon" href="/user-assets/images/icons/FAVICON SW.png" type="image/png">
    <link rel="stylesheet" href="/userMng-assets/css/vendor/vendor.min.css">
    <link rel="stylesheet" href="/userMng-assets/css/plugins/plugins.min.css">
    <link rel="stylesheet" href="/userMng-assets/css/style.min.css">
    <%- include('./partials/solewayCss.ejs') %>

    <style>
        .wallet-section {
            display: flex;
            align-items: flex-start;
            gap: 20px;
            margin-bottom: 40px;
        }

        .wallet-box {
            width: 350px;
            padding: 25px;
            border: 1px solid #c7c7c7;
            border-radius: 8px;
            background-image: linear-gradient(-180deg, rgba(255, 255, 255, 0.5) 0%, rgba(0, 0, 0, 0.50) 100%);
            background-blend-mode: lighten;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            color: rgb(75, 75, 75);
        }

        .money-input {
            width: 100%;
            padding: 10px;
            margin: 15px 0;
            border: 1px solid #6f6f6f;
            border-radius: 5px;
            color: #000000;
        }

        .add-money-btn {
            padding: 12px 25px;
            background-color: #000000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .add-money-btn:hover {
            background-color: #7e7e7e;
        }

        .table_page {
            overflow-x: auto;
            margin-bottom: 20px;
            width: 100%;
        }

        .table_page table {
            width: 100%;
            border-collapse: collapse;
        }

        .table_page th,
        .table_page td {
            padding: 12px 15px;
            text-align: left;
            white-space: nowrap;
            border-bottom: 1px solid #dddddd;
        }

        .table_page th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .table_page tbody tr:hover {
            background-color: #f5f5f5;
        }

        .pagination {
            display: flex;
            justify-content: center;
            padding-left: 0;
            list-style: none;
            border-radius: 0.25rem;
            margin-top: 30px;
        }

        .page-item {
            margin: 0 5px;
        }

        .page-item .page-link {
            position: relative;
            display: block;
            padding: 0.5rem 0.75rem;
            margin-left: -1px;
            line-height: 1.25;
            color: #000000;
            background-color: #fff;
            border: 1px solid #dee2e6;
            text-decoration: none;
            border-radius: 0.25rem;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .page-item .page-link:hover {
            background-color: #000000;
            color: white;
            border-color: #000000;
        }

        .page-item.active .page-link {
            z-index: 1;
            color: #fff;
            background-color: #000000;
            border-color: #000000;
        }

        .page-item.disabled .page-link {
            color: #6c757d;
            pointer-events: none;
            background-color: #fff;
            border-color: #dee2e6;
        }

        .account-nav {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .account-nav a {
            color: #000000;
            text-decoration: none;
            margin-right: 20px;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .account-nav a:hover {
            background-color: #000000;
            color: white;
        }

        .account-nav a.active {
            background-color: #000000;
            color: white;
        }
    </style>
</head>

<body>
    <!-- Header (same as original) -->
    <header class="header-section d-none d-xl-block">
        <div class="header-wrapper">
            <div class="header-bottom header-bottom-color--black section-fluid sticky-header sticky-color--Black blackbg">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12 d-flex align-items-center justify-content-between color--Black blackbg">
                            <div class="header-logo">
                                <div class="logo">
                                    <a href="/"><img src="/userMng-assets/images/logo/1.png" alt=""></a>
                                </div>
                            </div>
                            <div class="main-menu menu-color--black menu-hover-color--Black">
                                <nav>
                                    <ul>
                                        <li><a href="/">Home</a></li>
                                        <li><a href="/Shop">Shop</a></li>
                                        <li><a href="/Blog">Blog</a></li>
                                        <li><a href="/About">About Us</a></li>
                                        <li><a href="/Contact">Contact Us</a></li>
                                    </ul>
                                </nav>
                            </div>
                            <ul class="header-action-link action-color--black action-hover-color--white">
                                <li>
                                    <a href="#offcanvas-about" class="offacnvas offside-about offcanvas-toggle">
                                        <i class="icon-menu"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Header -->
    <div class="mobile-header mobile-header-bg-color--black section-fluid d-lg-block d-xl-none">
        <div class="container">
            <div class="row">
                <div class="col-12 d-flex align-items-center justify-content-between">
                    <div class="mobile-header-left">
                        <ul class="mobile-menu-logo">
                            <li>
                                <a href="/">
                                    <div class="logo">
                                        <img src="/userMng-assets/images/logo/1.png" alt="">
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="mobile-right-side">
                        <ul class="header-action-link action-color--black action-hover-color--white">
                            <li>
                                <a href="#mobile-menu-offcanvas" class="offcanvas-toggle offside-menu">
                                    <i class="icon-menu"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Breadcrumb -->
    <div class="breadcrumb-section breadcrumb-bg-color--white">
        <div class="breadcrumb-wrapper">
            <div class="container">
                <div class="col-12">
                    <h3 class="breadcrumb-title">My Wallet</h3>
                    <div class="breadcrumb-nav breadcrumb-nav-color--black breadcrumb-nav-hover-color--white">
                        <nav aria-label="breadcrumb">
                            <ul>
                                <li><a href="/">Home</a></li>
                                <li><a href="/Account">My Account</a></li>
                                <li class="active" aria-current="page">Wallet</li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container" style="margin-top: 50px; margin-bottom: 50px;">
        <!-- Account Navigation -->
        <div class="account-nav">
            <a href="/Account">Dashboard</a>
            <a href="/orders">Orders</a>
            <a href="/wallet" class="active">Wallet</a>
            <a href="/Account#coupon">Coupons</a>
            <a href="/Account#address">Addresses</a>
        </div>

        <div class="row">
            <div class="col-12">
                <h4>My Wallet</h4>
                
                <!-- Wallet Balance and Add Money Section -->
                <div class="wallet-section">
                    <div class="wallet-box">
                        <h5>Current Balance</h5>
                        <h3>â‚¹ <%= wallet ? wallet.balance.toFixed(2) : '0.00' %></h3>

                        <!-- Input field for adding money -->
                        <label for="add-amount">Enter Amount to Add</label>
                        <input id="add-amount" class="money-input" placeholder="Enter amount" type="number">

                        <!-- Button to add money -->
                        <button class="add-money-btn" onclick="addToWallet()">Add Money</button>
                    </div>
                </div>

                <!-- Transaction History -->
                <div class="table_page table-responsive">
                    <h5>Transaction History</h5>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Type</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (transactions && transactions.length > 0) { %>
                                <% for (let i = 0; i < transactions.length; i++) { %>
                                    <tr>
                                        <td><%= new Date(transactions[i].transactionDate).toLocaleString() %></td>
                                        <td>â‚¹ <%= transactions[i].amount.toFixed(2) %></td>
                                        <td><%= transactions[i].type || 'Credit' %></td>
                                        <td><%= transactions[i].status %></td>
                                    </tr>
                                <% } %>
                            <% } else { %>
                                <tr>
                                    <td colspan="4" class="text-center">No transactions found.</td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <% if (totalPages > 1) { %>
                    <nav aria-label="Wallet Page navigation">
                        <ul class="pagination">
                            <!-- Previous Button -->
                            <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                                <a class="page-link" href="?page=<%= currentPage - 1 %>" aria-label="Previous">
                                    <span aria-hidden="true">&laquo; Previous</span>
                                </a>
                            </li>

                            <!-- Page Numbers -->
                            <% for (let i = 1; i <= totalPages; i++) { %>
                                <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                                    <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                                </li>
                            <% } %>

                            <!-- Next Button -->
                            <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                                <a class="page-link" href="?page=<%= currentPage + 1 %>" aria-label="Next">
                                    <span aria-hidden="true">Next &raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <%- include('./partials/userFooter.ejs') %>

    <!-- Scripts -->
    <script src="/userMng-assets/js/vendor/vendor.min.js"></script>
    <script src="/userMng-assets/js/plugins/plugins.min.js"></script>
    <script src="/userMng-assets/js/main.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        async function addToWallet() {
            const amount = document.getElementById('add-amount').value;

            if (!amount || isNaN(amount) || amount <= 0) {
                alert("Please enter a valid amount to add.");
                return;
            }

            // Send the request to create the order on the server
            const response = await fetch('/addToWallet', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ amount: parseFloat(amount) }),
            });

            const order = await response.json();
            if (!order) {
                alert("Failed to create the order. Please try again.");
                return;
            }

            // Razorpay options
            const options = {
                key: 'rzp_test_72sGbnDINNYlKN',
                amount: amount * 100,
                currency: 'INR',
                name: 'Soleway',
                description: 'Add Money to Wallet',
                order_id: order.id,
                callback_url: '/wallet',
                prefill: {
                    name: 'User Name',
                    email: 'user@example.com',
                    contact: '9999999999',
                },
                theme: {
                    color: '#F37254',
                },
                handler: async function (response) {
                    try {
                        const result = await fetch('/walletPaymentSuccess', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                paymentId: response.razorpay_payment_id,
                                orderId: response.razorpay_order_id,
                                amount: amount,
                            }),
                        });

                        const data = await result.json();

                        if (data.success) {
                            Swal.fire({
                                title: 'Success!',
                                text: 'Money successfully added to your wallet!',
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    window.location.href = '/wallet';
                                }
                            });
                        } else {
                            alert('Something went wrong. Please try again.');
                        }
                    } catch (error) {
                        console.log('Error adding money to wallet:', error);
                    }
                },
            };

            // Open Razorpay checkout
            const rzp = new Razorpay(options);
            rzp.open();
        }
    </script>

</body>

</html>